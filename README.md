# message-board
Это сервис, позволяющий пользователям регистрироваться, авторизовываться, создавать, редактировать и удалять сообщения. 

## Запуск
Чтобы запустить сервис, нужно в папке build исполнить команду
```sh
sudo docker-compose up -d
```
После чего требуется запустить файл 01_create_tables.up.sql и запустить main.go
Примеры запросов хранятся в [workspace postman](https://www.postman.com/quatrotest/workspace/message-board)


# Архитектура

message-board состоит из двух параллельно запущенных серверов - gRPC и REST, которые имеют общую базу данных. gRPC серверы сгенерированы из proto-файлов [message.proto](https://github.com/VorobevNickolay/message-board/blob/main/api/proto/message.proto) и [user.proto](https://github.com/VorobevNickolay/message-board/blob/main/api/proto/user.proto)

Также проект разделен на две части - взаимодействия с пользователями и сообщениями, каждая часть имеет три раздела: server(который так же делится на grpc и Rest), service и store.
Каждый из серверов получает запрос, проверяет его на валидность, после чего вызывает Service и на основе полученных результатов выдает ответ.

Service отвечает за проверку правильности запроса. MessageService имеет ли пользователь право редактирования/удаления. UserService отвечает за шифровку и расшифровку пароля.

Store отвечает за взаимодействие с данными, если операция проверена сервисом, то она выполняется store, который возвращает результат своей работу сервису. Реализовано два вида каждого Store - InMemoryStore, то есть данные хранятся в памяти программы и если она остановлена или перезапущена, то они пропадают, и PostgreSQL Store, то есть данные хранятся в PostgreSQL базе данных, взаимодействие с которой происходит с помощью пакета pgx.
 
Структура проекта сделана на основе https://github.com/golang-standards/project-layout

# Requests

Примеры всех запросов находятся в папке [postman](https://github.com/VorobevNickolay/note-service/tree/master/postman)

## User router

### Sign-up

'POST /user'

Позволяет зарегистрировать пользователя, получает имя и пароль пользователя, после чего создает пользователя и возвращает его.
### Sign-up

'POST /user/:id'

Позволяет войти пользователю, получает имя и пароль пользователя, после чего создает jwt-токен и возвращает его, все действия.

## Message router

Каждый из методов MessageRouter вызывает перед собой middle-ware функцию, которая получает jwt-токен и расшивровывает его в id пользователя. Таким образом, действия с заметками могут совершить только вошедшие пользователи

### GetMessages

'GET /message'

Возвращает пользователю все существующие сообщения.

### GetMessageByID

'GET /message/:id'

Возвращает пользователю сообщение с соответсвующим ID

### PostMessage

'POST /message'

Позволяет создать сообщение

### UpdateMessage

'PUT /message/:id'

Позволяет пользователю обновить свое собщение

### DeleteMessage

'DELETE /message/:id'

Позволяет пользователю удалить своё сообщение
